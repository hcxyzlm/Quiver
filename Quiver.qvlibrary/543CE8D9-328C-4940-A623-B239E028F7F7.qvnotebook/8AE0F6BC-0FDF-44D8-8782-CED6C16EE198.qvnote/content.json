{
  "title": "iOS11&iPhoneX 适配总结",
  "cells": [
    {
      "type": "markdown",
      "data": "### 前言\n1. 随着iponeX的发布，我们ios开发者对它的适配工作也提上了日程，适配过程中遇到很多坑，这里几个部分需要注意的地方\n\n### 导航栏\n1. ios11之前的导航栏默认高度是64(这里的高度是指statusBar + NavigationBar，statusBar高度为20,NavigationBar为44)，但是iponeX上由于刘海的出现statusBar的高度由以前20变成了44，所以iponeX的高度变成了88。所以需要做适配\n2. 由于我们之前的NavigationBar是自定义view，之前的高度都是写死了frame= {0,0,DEVICE_SCREEN_WIDTH,64}，用reaveal的查看了系统的NavigationBar的结构，发现结构如下：\n![WX20180201-155455.png](quiver-image-url/0E47172661011A2E947139397D880EEB.png =539x155)\n,frame(0,44,375,44)。这里仿照系统实现了一个自定义NavigationBar，具体导航栏设计参考我另一篇文章。\n[导航栏设计方案](https://www.tapd.cn/20604231/markdown_wikis/#1120604231001000378)\n\n### 项目中VC页面的tableview布局影响\n1. 我们项目的VC对tableview是用NavigationBar的作为起点对tableview做布局。\n ```objc\n  CGFloat width = self.view.frame.size.width;\n  CGFloat height = self.view.frame.size.height - CGRectGetHeight(self.customNavigationBar.frame);\n  _tableView = [[UITableView alloc] initWithFrame:CGRectMake(0, CGRectGetHeight(self.customNavigationBar.frame), width, height) style:UITableViewStylePlain];\n ```\n这里的导航栏一直是64，导致在iPhoneX的tableView的起止位置为64，导航栏会挡住一部分。为了布局统一性和兼容性，我们只在安全区域做布局，iPhoneX机型的SafeAreaInsets(44,0,0,34),其他机型的SafeAreaInsets(20，0,0，0)\n![IMAGE](quiver-image-url/D25F5E38D4ACECF5DDA16CC5F4FE4D24.jpg =640x418)\n\n2.为了兼容和统一，添加了3个宏。定义如下\n```objc\n\n#define SAFEAREA_INSETS ([UIView safeAreaInsetsForWindow])\n#define kNavigationBarHeight 44.0 // 导航栏的高度，都是44\n\n#define kNavigationBarInsetTop (SAFEAREA_INSETS.top + kNavigationBarHeight) // 导航栏距离屏幕顶部距离 iponeX = 84,other = 64\n\n#define kWindowInsetTop (SAFEAREA_INSETS.top) // 状态栏距离屏幕顶部距离\n\n#define kWindowInsetBottom (SAFEAREA_INSETS.bottom) // 安全区域距离屏幕底部距离\n\n\n+ (UIEdgeInsets)safeAreaInsetsForWindow {\n    CGRect statusFrame = [UIApplication sharedApplication].statusBarFrame;\n    if (@available(iOS 11.0, *)) {\n        UIEdgeInsets windowInsets = [UIApplication sharedApplication].keyWindow.safeAreaInsets;\n        \n        if (![UIApplication sharedApplication].statusBarHidden && windowInsets.top == 0) {\n            windowInsets.top = statusFrame.size.height;\n        }\n        \n        NSLog(@\"%@\",NSStringFromUIEdgeInsets(windowInsets));\n        \n        return windowInsets;\n    } else {\n        // Fallback on earlier versions\n        if ([UIApplication sharedApplication].statusBarHidden) {\n            return UIEdgeInsetsZero;\n        } else {\n            return UIEdgeInsetsMake(statusFrame.size.height, 0, 0, 0);\n        }\n    }\n}\n\n\n```\n现在的tableview的布局为\n```objc\n[_tableView mas_makeConstraints:^(MASConstraintMaker *make) {\n      make.left.right.bottom.mas_equalTo(self.view);\n      make.top.mas_equalTo(self.view).offset(kNavigationBarInsetTop);\n  }];\n```\n\n### tabbar的高度变化\n1. ios11之前tabbar高度是49 px,iponeX上由于底部的安全区域，高度为83(49 + 34)。\n2. 项目中使用自定义的tabbar,现在才用系统的tabbar add 我们自定义tabbar view\n\n### 更多iOS11&iPhoneX的文章参考\n[ionex参考博客](https://github.com/2877025939/iOS11)\n\n"
    }
  ]
}