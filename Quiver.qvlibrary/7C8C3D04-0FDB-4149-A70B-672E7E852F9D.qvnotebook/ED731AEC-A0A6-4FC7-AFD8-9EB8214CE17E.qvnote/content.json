{
  "title": "越狱初体验",
  "cells": [
    {
      "type": "markdown",
      "data": "### 前言\n1. 最近想深入了解Ios逆向。所以在闲鱼掏了个二手的ipone5，系统版本为8.2。第一天马上试手，用[Reveal](https://revealapp.com/)这个工具来查看QQ音乐app的应用结构\n### 一. 流程概括\n![image.png](https://upload-images.jianshu.io/upload_images/2024292-5fc9218fe9ca16d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n### 二.iOS设备越狱\n##### 1.  越狱手机\n越狱的方式不算多，PP助手、爱思助手，本人用了这两款，傻瓜式操作，一键越狱，各位可Google具体操作。目前是掏回来的手机已经越狱好了，价格在200~300之间\n##### 2. 安装相关插件\n打开Cydia,搜索OpenSSH，CydiaSubstrate并安装\ncydia(一种破解软件管理源，类似于ituns的)\n![IMG_0004.PNG](https://upload-images.jianshu.io/upload_images/2024292-866402b3242b4bf3.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![IMG_0005.PNG](https://upload-images.jianshu.io/upload_images/2024292-337a51a6c038ffa0.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n### 三. 安装新版的Reveal\n本人用的是Reveal45的版本\nReveal RevealServer.framework的位置\n![image.png](https://upload-images.jianshu.io/upload_images/2024292-d76fea66a5a17c10.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n#### 配置libReveal.plist\n![IMAGE](quiver-image-url/783ECC59EF3A62819C36152628735BD1.jpg =652x283)\n\n这里我们填入QQ 音乐和一些的 bundle id\n不知道bundle id的app，可以去一个网站查询。\n[传送门](https://www.deepaso.com/)\n\n### 四. 连接SSH到越狱设备上\n前提是手机和电脑必须是同一个wifi下\n##### 1. 打开终端\n输入ssh root@<手机ip>\n![image.png](https://upload-images.jianshu.io/upload_images/2024292-a95479f247205977.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n默认密码: alpine\n![image.png](https://upload-images.jianshu.io/upload_images/2024292-e659b44f2c974fc8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n### 上传文件\nRevealServer.framework\nlibReveal.plist\n命令: \nscp libReveal.plist root@<手机ip>:/Library/MobileSubstrate/DynamicLibraries/\n\nscp RevealServer.framework/RevealServer root@<手机ip>:/Library/MobileSubstrate/DynamicLibraries/libReveal.dylib\n这里新版的Reveal的framework没有libReveal.dylib，所以把framework里面的RevealServer上传重名为libReveal.dylib文件\n![image.png](https://upload-images.jianshu.io/upload_images/2024292-d0373ed23f75f9f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n### 打开QQ 音乐, 打开reveal\n![IMAGE](quiver-image-url/9B6FBE914CC2CA99F373B29D4A70862C.jpg =1506x967)\n如果没有Reveal打开没有看到app，可以重启越狱手机。\n\n### 原理\n我们连接到真机的目录上，进入/目录。可以看到，ipone 类似 linux系统的。\n![IMAGE](quiver-image-url/8E62F8F7CB76FF5A2A65FA82640DB9E6.jpg =838x111)\n\n常用的目录如下：\n/Applications/   --- 常用的软件\n/private/       ---- 用户的相关，比如录用，多媒体资料\n/Library/       ----- 系统库相关\n/bin/           -----命令\n/System/        ----- 系统设置相关\n\n\n我们回顾集成 reveal 的方式，是需要把 reveal.framework,嵌入我们的工程中，然后Run Script把reval 的静态库 copy 到工程师。可以 hook reveal  app。\n这种属于静态连接\n\n/Library/MobileSubstrate/DynamicLibraries目录下，可以加载动态库\n![IMAGE](quiver-image-url/0F37E6AA02F0189F05C88D0709B07084.jpg =796x227)\n这个目录每个dylib都有一个对应的 plist 的文件，\nlibReveal.plist就是 reveal 的配置文件，过滤需要 reveal 的 app的 bundle id\n我们启动 QQ 音乐的时候，reveal 动态库会监控 qq 音乐的。起到 hoobk 的作用，这种属于动态库加载的效果\n\n## MobileLoader 将第三方动态加载到运行的 app中\n### MobileLoader加载dylib的过程\n首先通过环境变量DYLD_INSERT_LIBRARIES把他加载到目标(这里是 reveal)应用中，然后查找特定的目录(具体的目录依赖于越狱工具的加载机制，通常在/Library/MobileSubstrate/DynamicLibraries/), coolstar的Electra越狱的iOS 11 /bootstrap/Library/SBInject 对应之前的系统的路径DynamicLibraries下的动态库plist文件。如果pilst文件的配置信息符合当前运行的应用，就会通过dlopen函数打开对应的dylib文件。\n\ndydia Tweak工作原理（一个基础依赖包）提供软件运行的公共库，可以用来动态替换内存中的代码、数据等，所以iOS系统越狱环境下安装绝大部分插件，必须首先安装Cydia Substrate\n\n1. MobileHooker： 替换覆盖系统的方法，这个过程被称为Hooking(挂钩)\n2. MobileLoader: MobileLoader的主要功能是将指定目录下的补丁文件（动态库文件）加载到指定的程序中。MobileLoader首先会将自己通过DYLD_INSERT_LIBRARIES加载到目录程序中，然后它会在/Library/MobileSubstrate/DynamicLibraries/目录下寻找需要加载的第三方补丁文件并使用dlopen加载它们。是否加载是通过一个plist文件来控制的，该文件中可以指定目标程序的bundle id等\n\n每一个.dylib文件都会有一个同名的.plist文件。.plist文件的作用就是用来指定tweak插件的作用对象。\n\n![IMAGE](quiver-image-url/42CC61036BCEECED9820A9F4A58C0E38.jpg =706x958)\n### \n\nhttps://kunnan.github.io/2018/07/01/MobileLoader/\n\n总给： 因为 ios 不像 linux,android 一样开源，对于程序员来说是一个黑盒。通过越狱的方式，学习iOS的系统流程，一些基本的原理。\n"
    }
  ]
}